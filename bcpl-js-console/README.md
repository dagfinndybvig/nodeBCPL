# BCPL JS Console

This is a JavaScript port of the BCPL INTCODE interpreter (`icint.c`).
It allows compiling and running BCPL programs in a Node.js environment.

## Files

- `icint.js`: The main interpreter and assembler (ported from `icint.c`).
- `syni`: The syntax analyzer (INTCODE).
- `trni`: The translator (INTCODE).
- `cgi`: The code generator (INTCODE).
- `libhdr`: The standard library header.
- `test.b`: A sample BCPL program.

## Source Code and Generated Files

### Source Code
The source code for your program is a `.b` file (e.g., `test.b`). You can create your own BCPL files in this directory.
- **Input**: `filename.b` (Your BCPL source code)
- **Library**: `libhdr` (Standard library header, usually included via `GET "LIBHDR"`)

### Generated Files
The compilation process generates the following intermediate and final files in the current directory:

1. **`OCODE`**: Intermediate code generated by the first pass (`syni` + `trni`).
   - *Note*: The compiler writes specifically to a file named `OCODE` in the current working directory.
2. **`INTCODE`**: The final executable bytecode generated by the code generator (`cgi`).
   - *Note*: This is the output of the `cgi` pass, which we capture from stdout or file output.

## Usage

### Automated Compilation and Execution

Use the `compile.sh` script to compile and run a BCPL program:

```bash
./compile.sh test.b
```

### Manual Steps

1. **Prepare the compiler:**
   Concatenate `syni` and `trni` (removing the `Z` from `trni`) to create `synitrni`.
   ```bash
   cat syni > synitrni
   tail -n +4 trni >> synitrni
   ```

2. **Compile BCPL to OCODE:**
   ```bash
   node icint.js synitrni -itest.b
   ```
   This produces an `OCODE` file.

3. **Compile OCODE to INTCODE:**
   ```bash
   node icint.js cgi -iOCODE > INTCODE
   ```
   This produces an `INTCODE` file.

4. **Run INTCODE:**
   ```bash
   node icint.js INTCODE
   ```

## Implementation Details

- The interpreter uses 16-bit signed arithmetic to match the original C implementation.
- `syni` and `trni` are concatenated to share the label namespace (or rather, to avoid clearing labels between passes, although they mostly use globals).
- `trni` writes directly to a file named `OCODE` (ignoring standard output redirection for the code itself).
